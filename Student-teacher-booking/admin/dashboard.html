<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin Dashboard - Manage system, teachers, and students">
    <title>Admin Dashboard - EduConnect</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="admin-navbar">
        <div class="container">
            <div class="nav-brand">
                <h2>üìö EduConnect <span class="admin-badge">Admin</span></h2>
            </div>
            <div class="nav-links">
                <span id="userNameDisplay" class="user-name">System Administrator</span>
                <button id="logoutBtn" class="btn btn-small btn-secondary">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-menu">
                <a href="#" class="sidebar-item active" data-section="overview">
                    <span class="icon material-icons">dashboard</span>
                    <span>Overview</span>
                </a>
                <a href="#" class="sidebar-item" data-section="teachers">
                    <span class="icon material-icons">school</span>
                    <span>Teachers</span>
                </a>
                <a href="#" class="sidebar-item" data-section="students">
                    <span class="icon material-icons">groups</span>
                    <span>Students</span>
                </a>
                <a href="#" class="sidebar-item" data-section="appointments">
                    <span class="icon material-icons">event</span>
                    <span>Appointments</span>
                </a>
                <a href="#" class="sidebar-item" data-section="logs">
                    <span class="icon material-icons">assignment</span>
                    <span>Activity Logs</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Overview Section -->
            <section id="overviewSection" class="dashboard-section active">
                <h1>System Overview</h1>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üë®‚Äçüè´</div>
                        <div class="stat-content">
                            <h3 id="totalTeachers">0</h3>
                            <p>Total Teachers</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë®‚Äçüéì</div>
                        <div class="stat-content">
                            <h3 id="totalStudents">0</h3>
                            <p>Total Students</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-content">
                            <h3 id="totalAppointments">0</h3>
                            <p>Total Appointments</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-content">
                            <h3 id="pendingRegistrations">0</h3>
                            <p>Pending Approvals</p>
                        </div>
                    </div>
                </div>

                <div class="recent-section">
                    <h2>Recent Activity</h2>
                    <div id="recentActivity" class="activity-list">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Teachers Section -->
            <section id="teachersSection" class="dashboard-section">
                <div class="section-header">
                    <h1>Manage Teachers</h1>
                    <button id="addTeacherBtn" class="btn btn-primary">Add Teacher</button>
                </div>

                <div class="search-container">
                    <input type="text" id="teacherSearch" placeholder="Search teachers..." class="search-input">
                </div>

                <div id="teachersTable" class="data-table-container">
                    <!-- Teachers table will be loaded here -->
                </div>
            </section>

            <!-- Students Section -->
            <section id="studentsSection" class="dashboard-section">
                <h1>Manage Students</h1>

                <div class="filter-tabs">
                    <button class="tab-btn active" data-filter="all">All Students</button>
                    <button class="tab-btn" data-filter="pending">Pending Approval</button>
                    <button class="tab-btn" data-filter="approved">Approved</button>
                </div>

                <div class="search-container">
                    <input type="text" id="studentSearch" placeholder="Search students..." class="search-input">
                </div>

                <div id="studentsTable" class="data-table-container">
                    <!-- Students table will be loaded here -->
                </div>
            </section>

            <!-- Appointments Section -->
            <section id="appointmentsSection" class="dashboard-section">
                <h1>All Appointments</h1>

                <div class="filter-tabs">
                    <button class="tab-btn active" data-filter="all">All</button>
                    <button class="tab-btn" data-filter="pending">Pending</button>
                    <button class="tab-btn" data-filter="approved">Approved</button>
                    <button class="tab-btn" data-filter="cancelled">Cancelled</button>
                </div>

                <div id="appointmentsTable" class="data-table-container">
                    <!-- Appointments table will be loaded here -->
                </div>
            </section>

            <!-- Logs Section -->
            <section id="logsSection" class="dashboard-section">
                <h1>Activity Logs</h1>

                <div class="filter-container">
                    <select id="logTypeFilter" class="filter-select">
                        <option value="all">All Activities</option>
                        <option value="login">User Logins</option>
                        <option value="teacher">Teacher Actions</option>
                        <option value="appointment">Appointments</option>
                        <option value="message">Messages</option>
                    </select>
                    <input type="date" id="logDateFilter" class="filter-input">
                </div>

                <div id="logsTable" class="data-table-container">
                    <!-- Logs table will be loaded here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Add/Edit Teacher Modal -->
    <div id="teacherModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2 id="teacherModalTitle">Add Teacher</h2>
            <form id="teacherForm">
                <input type="hidden" id="teacherId">
                <div class="form-group">
                    <label for="teacherName">Full Name</label>
                    <input type="text" id="teacherName" required placeholder="Enter teacher name">
                </div>
                <div class="form-group">
                    <label for="teacherEmail">Email</label>
                    <input type="email" id="teacherEmail" required placeholder="Enter email">
                </div>
                <div class="form-group">
                    <label for="teacherPhone">Phone</label>
                    <input type="tel" id="teacherPhone" required placeholder="Enter phone number">
                </div>
                <div class="form-group">
                    <label for="teacherDepartment">Department</label>
                    <input type="text" id="teacherDepartment" required placeholder="Enter department">
                </div>
                <div class="form-group">
                    <label for="teacherSubject">Subject</label>
                    <input type="text" id="teacherSubject" required placeholder="Enter subject">
                </div>
                <div class="form-group">
                    <label for="teacherExperience">Experience (years)</label>
                    <input type="number" id="teacherExperience" required placeholder="Years of experience" min="0">
                </div>
                <div class="form-group" id="passwordGroup">
                    <label for="teacherPassword">Password</label>
                    <input type="password" id="teacherPassword" placeholder="Enter password" minlength="6">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Save Teacher</button>
            </form>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Application Scripts -->
    <script src="../js/firebase.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/admin.js"></script>
    <script src="../js/teacher.js"></script>
    <script src="../js/appointment.js"></script>
    <script src="../js/logs.js"></script>
    <script>
        // Check authentication
        checkAuth('admin');

        // Sidebar navigation
        const sidebarItems = document.querySelectorAll('.sidebar-item');
        const sections = document.querySelectorAll('.dashboard-section');

        sidebarItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionName = item.dataset.section;

                // Update active states
                sidebarItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                // Show selected section
                sections.forEach(s => s.classList.remove('active'));
                document.getElementById(sectionName + 'Section').classList.add('active');

                // Load section data
                loadSectionData(sectionName);
            });
        });

        // Filter tabs
        const tabBtns = document.querySelectorAll('.tab-btn');
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const parent = btn.parentElement;
                parent.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const filter = btn.dataset.filter;

                // Determine which section and reload data
                const section = btn.closest('.dashboard-section');
                if (section && section.id === 'studentsSection') {
                    loadStudents(filter);
                } else if (section && section.id === 'appointmentsSection') {
                    loadAllAppointments(filter);
                }
            });
        });

        // Load initial data
        loadSectionData('overview');

        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', logout);

        // Modal handlers
        const teacherModal = document.getElementById('teacherModal');
        const closeButtons = document.querySelectorAll('.modal-close');

        document.getElementById('addTeacherBtn').addEventListener('click', () => {
            document.getElementById('teacherModalTitle').textContent = 'Add Teacher';
            document.getElementById('teacherForm').reset();
            document.getElementById('teacherId').value = '';
            document.getElementById('teacherPassword').required = true;
            teacherModal.style.display = 'block';
        });

        closeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                teacherModal.style.display = 'none';
            });
        });

        window.addEventListener('click', (e) => {
            if (e.target === teacherModal) teacherModal.style.display = 'none';
        });

        // Teacher form submit
        document.getElementById('teacherForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const teacherId = document.getElementById('teacherId').value;

            const teacherData = {
                name: document.getElementById('teacherName').value,
                email: document.getElementById('teacherEmail').value,
                phone: document.getElementById('teacherPhone').value,
                department: document.getElementById('teacherDepartment').value,
                subject: document.getElementById('teacherSubject').value,
                experience: document.getElementById('teacherExperience').value,
                password: document.getElementById('teacherPassword').value
            };

            if (teacherId) {
                await updateTeacher(teacherId, teacherData);
            } else {
                await addTeacher(teacherData);
            }

            teacherModal.style.display = 'none';
            document.getElementById('teacherForm').reset();
        });

        // Search handlers
        document.getElementById('teacherSearch').addEventListener('input', (e) => {
            searchTeachers(e.target.value);
        });

        document.getElementById('studentSearch').addEventListener('input', (e) => {
            searchStudents(e.target.value);
        });

        // Log filters
        document.getElementById('logTypeFilter').addEventListener('change', () => {
            loadActivityLogs();
        });

        document.getElementById('logDateFilter').addEventListener('change', () => {
            loadActivityLogs();
        });

        // Function to load section data
        async function loadSectionData(section) {
            switch (section) {
                case 'overview':
                    await loadAdminOverview();
                    break;
                case 'teachers':
                    await loadTeachersData();
                    break;
                case 'students':
                    await loadStudents('all');
                    break;
                case 'appointments':
                    await loadAllAppointments('all');
                    break;
                case 'logs':
                    await loadActivityLogs();
                    break;
            }
        }
    </script>
</body>

</html>